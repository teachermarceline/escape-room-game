<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ” The Johnson Mystery â€” Escape Room</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0e17;--card:#151b2b;--card2:#1e2538;--gold:#f5c518;--gold2:#c9a30a;--red:#e94560;--green:#3fb950;--txt:#e6edf3;--dim:#8b95a5}
html,body{height:100%;overflow:hidden}
body{font-family:'Inter',Arial,sans-serif;background:var(--bg);color:var(--txt)}
button{font-family:inherit;cursor:pointer;border:none;outline:none}
input{font-family:inherit;outline:none;border:none}

.screen{position:fixed;inset:0;display:none;flex-direction:column;z-index:1}
.screen.active{display:flex}

/* INTRO */
#intro{align-items:center;justify-content:center;text-align:center;padding:20px;
background:radial-gradient(ellipse at 50% 30%,#1a1530 0%,#0a0e17 70%)}
.intro-badge{font-family:'Cinzel',Georgia,serif;font-size:.8rem;letter-spacing:5px;
color:var(--gold);margin-bottom:10px;text-transform:uppercase;opacity:.8}
.intro-title{font-family:'Cinzel',Georgia,serif;font-size:clamp(1.8rem,5vw,3rem);
font-weight:900;color:var(--gold);margin-bottom:20px;line-height:1.2;
text-shadow:0 0 50px rgba(245,197,24,.2)}
.intro-story{max-width:600px;font-size:clamp(.85rem,2vw,1rem);line-height:1.9;
color:var(--dim);margin-bottom:30px}
.intro-story b{color:var(--txt);font-weight:600}
.intro-chars{display:flex;gap:14px;justify-content:center;flex-wrap:wrap;margin-bottom:30px}
.char-card{background:var(--card);border:1px solid rgba(245,197,24,.12);border-radius:14px;
padding:14px 12px 10px;width:120px;text-align:center;transition:.3s}
.char-card:hover{border-color:var(--gold);transform:translateY(-3px);
box-shadow:0 8px 25px rgba(245,197,24,.1)}
.char-avatar{width:60px;height:60px;border-radius:50%;margin:0 auto 8px;
display:flex;align-items:center;justify-content:center;font-size:1.8rem;
border:2px solid var(--gold2)}
.char-card .c-name{font-weight:700;font-size:.8rem}
.char-card .c-role{font-size:.68rem;color:var(--dim);margin-top:2px}

.btn-start{background:linear-gradient(135deg,var(--gold),var(--gold2));color:#0a0e17;
font-family:'Cinzel',Georgia,serif;font-weight:700;font-size:clamp(.9rem,2vw,1.1rem);
padding:16px 44px;border-radius:50px;letter-spacing:2px;text-transform:uppercase;
transition:.3s;box-shadow:0 4px 30px rgba(245,197,24,.25)}
.btn-start:hover{transform:scale(1.06);box-shadow:0 6px 40px rgba(245,197,24,.4)}
.btn-start:active{transform:scale(.98)}

/* TOPBAR */
#topbar{background:rgba(10,14,23,.94);backdrop-filter:blur(10px);
border-bottom:1px solid rgba(245,197,24,.1);padding:10px 16px;
display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:6px;flex-shrink:0}
.tb-room{font-family:'Cinzel',Georgia,serif;font-weight:700;font-size:clamp(.75rem,2vw,.95rem);color:var(--gold)}
.tb-group{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.tb-pill{display:flex;align-items:center;gap:4px;font-size:.75rem;background:var(--card);
padding:5px 10px;border-radius:20px;border:1px solid rgba(255,255,255,.05)}
.tb-pill .ic{font-size:.9rem}
#timer{font-weight:700;font-variant-numeric:tabular-nums}
#timer.warn{color:var(--red);animation:pulse 1s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.tb-btn{background:var(--card2);color:var(--gold);padding:5px 12px;border-radius:20px;
font-size:.72rem;font-weight:600;border:1px solid rgba(245,197,24,.15);transition:.2s}
.tb-btn:hover{background:var(--gold);color:var(--bg)}
.tb-btn:active{transform:scale(.95)}

/* ROOM */
#room-wrap{flex:1;position:relative;overflow:hidden}
#room-bg{position:absolute;inset:0;background-size:cover;background-position:center;transition:.5s}
#room-bg::after{content:'';position:absolute;inset:0;
background:radial-gradient(ellipse at center,rgba(0,0,0,.1) 20%,rgba(0,0,0,.65) 100%)}

.obj-btn{position:absolute;z-index:5;width:clamp(52px,10vw,76px);height:clamp(52px,10vw,76px);
border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;
cursor:pointer;transition:.3s;background:rgba(0,0,0,.5);border:2px solid rgba(245,197,24,.45);
backdrop-filter:blur(3px);-webkit-backdrop-filter:blur(3px)}
.obj-btn:hover{transform:scale(1.15);border-color:var(--gold);box-shadow:0 0 25px rgba(245,197,24,.35)}
.obj-btn:active{transform:scale(.95)}
.obj-btn.solved{border-color:var(--green);opacity:.45;pointer-events:none}
.obj-btn .emo{font-size:clamp(1.2rem,3vw,1.7rem)}
.obj-btn .lbl{font-size:clamp(.45rem,1.1vw,.6rem);margin-top:1px;font-weight:500}
.obj-btn::before{content:'';position:absolute;inset:-5px;border-radius:50%;
border:2px solid rgba(245,197,24,.2);animation:ring 2.5s infinite}
.obj-btn.solved::before{display:none}
@keyframes ring{0%,100%{transform:scale(1);opacity:.8}50%{transform:scale(1.25);opacity:0}}

.door{position:absolute;right:3%;top:50%;transform:translateY(-50%);z-index:6;
width:clamp(58px,10vw,82px);height:clamp(72px,13vw,100px);
background:linear-gradient(180deg,#3a2a10,#24180a);border:3px solid #6b4f2a;
border-radius:10px;display:flex;flex-direction:column;align-items:center;
justify-content:center;cursor:pointer;transition:.3s;box-shadow:0 4px 20px rgba(0,0,0,.5)}
.door:hover{box-shadow:0 0 25px rgba(245,197,24,.25);border-color:var(--gold)}
.door:active{transform:translateY(-50%) scale(.95)}
.door.open{border-color:var(--green);box-shadow:0 0 25px rgba(63,185,80,.25)}
.door .d-icon{font-size:clamp(1.4rem,3.5vw,2rem)}
.door .d-label{font-size:clamp(.45rem,1vw,.6rem);color:var(--gold);font-weight:600;margin-top:3px}
.dots{display:flex;gap:3px;margin-top:4px}
.dot{width:clamp(8px,1.8vw,12px);height:clamp(8px,1.8vw,12px);border-radius:50%;
background:#1a1a1a;border:1px solid #444;transition:.3s}
.dot.on{background:var(--gold);border-color:var(--gold);box-shadow:0 0 6px rgba(245,197,24,.4)}

/* NARRATION */
#narration{background:rgba(10,14,23,.95);border-top:1px solid rgba(245,197,24,.08);
padding:12px 16px;display:flex;align-items:flex-start;gap:12px;min-height:70px;flex-shrink:0}
.nar-av{width:42px;height:42px;border-radius:50%;
background:linear-gradient(135deg,var(--gold),var(--gold2));
display:flex;align-items:center;justify-content:center;font-size:1.3rem;flex-shrink:0}
#nar-text{flex:1;font-size:clamp(.8rem,1.8vw,.92rem);line-height:1.65;color:var(--dim)}
#nar-text b{color:var(--gold)}
#nar-text em{color:var(--txt);font-style:normal;font-weight:600}

/* OVERLAY */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.78);backdrop-filter:blur(5px);
z-index:100;display:none;align-items:center;justify-content:center;padding:14px}
.overlay.show{display:flex}
.modal{background:var(--card);border:1px solid rgba(245,197,24,.12);border-radius:16px;
max-width:500px;width:100%;max-height:88vh;overflow-y:auto;position:relative;
animation:modalUp .3s ease}
@keyframes modalUp{from{opacity:0;transform:translateY(20px) scale(.95)}to{opacity:1;transform:none}}
.m-close{position:absolute;top:10px;right:12px;background:rgba(0,0,0,.3);color:#999;
font-size:1.1rem;z-index:5;width:30px;height:30px;border-radius:50%;display:flex;
align-items:center;justify-content:center;transition:.2s}
.m-close:hover{background:rgba(255,255,255,.1);color:#fff}
.m-header{width:100%;height:160px;display:flex;align-items:center;justify-content:center;
border-radius:16px 16px 0 0;position:relative;overflow:hidden}
.m-header img{width:100%;height:100%;object-fit:cover;position:absolute;inset:0}
.m-header .m-emoji{font-size:3.5rem;position:relative;z-index:2;
text-shadow:0 4px 20px rgba(0,0,0,.5);filter:drop-shadow(0 0 10px rgba(0,0,0,.3))}
.m-body{padding:18px}
.m-title{font-family:'Cinzel',Georgia,serif;font-size:1rem;color:var(--gold);margin-bottom:10px}
.m-text{font-size:.88rem;line-height:1.75;color:var(--dim);margin-bottom:16px}
.m-text em{color:var(--gold);font-style:normal;font-weight:600}
.q-box{background:var(--card2);border-radius:10px;padding:14px;border:1px solid rgba(245,197,24,.06)}
.q-box label{display:block;font-size:.85rem;font-weight:600;margin-bottom:8px;color:var(--txt)}
.q-row{display:flex;gap:8px}
.q-row input{flex:1;padding:10px 12px;border-radius:8px;border:2px solid #2a3040;
background:#0d1117;color:var(--txt);font-size:.92rem;transition:.2s}
.q-row input:focus{border-color:var(--gold)}
.q-row input.ok{border-color:var(--green)!important;background:rgba(63,185,80,.06)}
.q-row input.no{border-color:var(--red)!important;animation:shake .4s}
@keyframes shake{0%,100%{transform:translateX(0)}25%,75%{transform:translateX(-5px)}50%{transform:translateX(5px)}}
.btn-check{background:var(--gold);color:var(--bg);font-weight:700;padding:10px 20px;
border-radius:8px;font-size:.88rem;transition:.2s;flex-shrink:0}
.btn-check:hover{background:var(--gold2)}
.btn-check:active{transform:scale(.95)}
.feedback{margin-top:8px;font-size:.8rem;padding:7px 10px;border-radius:6px;display:none}
.feedback.show{display:block}
.feedback.yes{background:rgba(63,185,80,.1);color:var(--green);border:1px solid rgba(63,185,80,.15)}
.feedback.nope{background:rgba(233,69,96,.1);color:var(--red);border:1px solid rgba(233,69,96,.15)}

/* CODE MODAL */
.code-wrap{text-align:center;padding:28px 18px}
.code-wrap h3{font-family:'Cinzel',Georgia,serif;color:var(--gold);margin-bottom:6px;font-size:1.05rem}
.code-wrap p{color:var(--dim);font-size:.82rem;margin-bottom:6px}
.revealed-code{display:flex;gap:8px;justify-content:center;margin:14px 0}
.rev-box{width:44px;height:50px;border:2px dashed #333;border-radius:8px;display:flex;
align-items:center;justify-content:center;font-family:'Cinzel',Georgia,serif;font-size:1.3rem;
font-weight:700;color:#555;transition:.3s}
.rev-box.found{border:2px solid var(--gold);color:var(--gold);border-style:solid;
box-shadow:0 0 10px rgba(245,197,24,.15)}
.input-code{display:flex;gap:8px;justify-content:center;margin:14px 0}
.in-box{width:44px;height:50px;border:2px solid #2a3040;border-radius:8px;background:#0d1117;
display:flex;align-items:center;justify-content:center;font-family:'Cinzel',Georgia,serif;
font-size:1.4rem;font-weight:700;color:var(--txt);transition:.3s}
.in-box.filled{border-color:var(--gold);color:var(--gold)}
.in-box.right{border-color:var(--green);color:var(--green);box-shadow:0 0 10px rgba(63,185,80,.2)}
.in-box.wrong{border-color:var(--red);animation:shake .4s}
.keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;max-width:220px;margin:10px auto}
.kp{background:var(--card2);color:var(--txt);font-size:1.05rem;font-weight:600;
padding:12px;border-radius:8px;transition:.15s;border:1px solid rgba(255,255,255,.04)}
.kp:hover{background:var(--gold);color:var(--bg)}
.kp:active{transform:scale(.93)}
.kp-del{background:rgba(233,69,96,.12);color:var(--red)}
.kp-del:hover{background:var(--red);color:#fff}
.kp-go{background:rgba(63,185,80,.12);color:var(--green)}
.kp-go:hover{background:var(--green);color:#fff}
.code-fb{font-size:.82rem;min-height:20px;margin-top:6px}

/* ROOM 3 FILL */
.fill-wrap{padding:18px}
.fill-wrap h3{font-family:'Cinzel',Georgia,serif;color:var(--gold);text-align:center;
margin-bottom:4px;font-size:1.05rem}
.fill-wrap .sub{text-align:center;color:var(--dim);font-size:.82rem;margin-bottom:18px}
.fill-wrap .sub b{color:var(--gold)}
.sent{background:var(--card2);border-radius:10px;padding:14px;margin-bottom:10px;
font-size:clamp(.82rem,2vw,.95rem);line-height:1.8;display:flex;flex-wrap:wrap;
align-items:center;gap:5px;border:2px solid transparent;transition:.3s}
.sent.s-ok{border-color:var(--green);background:rgba(63,185,80,.04)}
.sent.s-no{border-color:var(--red);animation:shake .4s}
.fill-in{width:72px;padding:4px 8px;border-radius:6px;border:2px solid #2a3040;
background:#0d1117;color:var(--gold);font-size:.9rem;text-align:center;font-weight:600;transition:.2s}
.fill-in:focus{border-color:var(--gold)}
.fill-in.f-ok{border-color:var(--green);color:var(--green)}
.fill-in.f-no{border-color:var(--red);animation:shake .4s}
.btn-final{display:block;margin:16px auto 0;background:var(--gold);color:var(--bg);
font-weight:700;padding:12px 36px;border-radius:10px;font-size:.95rem;
font-family:'Cinzel',Georgia,serif;letter-spacing:1px;transition:.2s}
.btn-final:hover{background:var(--gold2);transform:scale(1.03)}
.btn-final:active{transform:scale(.97)}

/* INVENTORY */
.inv-bg{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:89;display:none}
.inv-bg.show{display:block}
.inv-panel{position:fixed;top:0;right:-320px;width:300px;height:100%;background:var(--card);
border-left:1px solid rgba(245,197,24,.1);z-index:90;transition:.35s;padding:18px;overflow-y:auto}
.inv-panel.show{right:0}
.inv-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.inv-top span{font-family:'Cinzel',Georgia,serif;color:var(--gold);font-size:.95rem}
.inv-x{background:none;color:#888;font-size:1.2rem}
.inv-card{background:var(--card2);border-radius:8px;padding:11px;margin-bottom:8px;
border-left:3px solid var(--gold);font-size:.78rem;line-height:1.65;color:var(--dim)}
.inv-card b{color:var(--txt)}
.inv-empty{color:#555;font-size:.82rem;text-align:center;padding:30px 0}

/* VICTORY */
#victory{align-items:center;justify-content:center;text-align:center;padding:20px;
background:radial-gradient(ellipse at 50% 40%,#0d1a12,#0a0e17 70%)}
.v-icon{font-size:clamp(3rem,8vw,4.5rem);margin-bottom:12px;animation:bounce 1s infinite}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
.v-title{font-family:'Cinzel',Georgia,serif;font-size:clamp(1.5rem,5vw,2.6rem);
font-weight:900;color:var(--green);margin-bottom:10px;text-shadow:0 0 30px rgba(63,185,80,.2)}
.v-sub{font-size:clamp(.82rem,2vw,1rem);color:var(--dim);max-width:480px;line-height:1.8;margin-bottom:24px}
.v-family{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-bottom:24px}
.v-member{text-align:center}
.v-member .vm-av{width:56px;height:56px;border-radius:50%;border:3px solid var(--green);
display:flex;align-items:center;justify-content:center;font-size:1.6rem;margin:0 auto 5px;background:var(--card)}
.v-member .vm-n{font-size:.72rem;font-weight:600}
.v-time{background:var(--card);padding:8px 20px;border-radius:20px;display:inline-block;
font-size:.82rem;margin-bottom:18px;border:1px solid rgba(63,185,80,.15)}
.btn-again{background:var(--green);color:#fff;font-weight:700;padding:12px 32px;
border-radius:50px;font-size:.95rem;transition:.2s}
.btn-again:hover{transform:scale(1.05)}

/* GAME OVER */
#gameover{align-items:center;justify-content:center;text-align:center;padding:20px;
background:radial-gradient(ellipse at 50% 40%,#1a0d0d,#0a0e17 70%)}
.go-icon{font-size:clamp(3rem,8vw,4.5rem);margin-bottom:12px}
.go-title{font-family:'Cinzel',Georgia,serif;font-size:clamp(1.5rem,5vw,2.4rem);
color:var(--red);margin-bottom:10px}
.go-sub{color:var(--dim);font-size:.95rem;margin-bottom:24px;max-width:380px;line-height:1.7}
.btn-retry{background:var(--red);color:#fff;font-weight:700;padding:12px 32px;
border-radius:50px;font-size:.95rem;transition:.2s}
.btn-retry:hover{transform:scale(1.05)}

/* R3 center */
.r3-center{position:absolute;inset:0;z-index:5;display:flex;align-items:center;justify-content:center;padding:16px}
.r3-card{background:rgba(21,27,43,.93);backdrop-filter:blur(8px);border:1px solid rgba(245,197,24,.12);
border-radius:16px;padding:30px 20px;text-align:center;max-width:400px;width:100%}
.r3-card h3{font-family:'Cinzel',Georgia,serif;color:var(--gold);margin-bottom:8px}
.r3-card p{color:var(--dim);font-size:.88rem;margin-bottom:18px;line-height:1.6}

/* SPARKLE */
.sparkles{position:fixed;inset:0;pointer-events:none;z-index:5;overflow:hidden}
.sp{position:absolute;width:6px;height:6px;border-radius:50%;animation:fall linear forwards}
@keyframes fall{0%{opacity:1;transform:translateY(-10px) rotate(0)}100%{opacity:0;transform:translateY(100vh) rotate(720deg)}}

@media(max-width:600px){
.obj-btn{width:48px;height:48px}.obj-btn .emo{font-size:1rem}.obj-btn .lbl{font-size:.4rem}
.door{width:50px;height:64px}.door .d-icon{font-size:1.1rem}.door .d-label{font-size:.4rem}
.dot{width:7px;height:7px}
#narration{padding:8px 12px;min-height:56px}
.nar-av{width:34px;height:34px;font-size:1rem}
.modal{max-width:100%;margin:8px}
.m-header{height:120px}
.rev-box,.in-box{width:38px;height:42px;font-size:1.1rem}
.inv-panel{width:260px}
}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{background:var(--card2);border-radius:3px}
</style>
</head>
<body>

<!-- â•â•â• INTRO â•â•â• -->
<div id="intro" class="screen active">
  <div class="intro-badge">ğŸ” Detective Case File #0042</div>
  <h1 class="intro-title">The Johnson Mystery</h1>
  <div class="intro-story">
    Detective Sam receives a strange message:<br>
    <b>"The Johnson family has vanished from their home."</b><br><br>
    Their house is locked. The only way to find them is to <b>learn everything about them</b> â€”
    who they are, where they are from, and what they love.<br><br>
    Can <b>you</b> solve the mystery?
  </div>
  <div class="intro-chars" id="intro-chars"></div>
  <button class="btn-start" id="btn-start">Begin Investigation</button>
</div>

<!-- â•â•â• GAME â•â•â• -->
<div id="game" class="screen">
  <div id="topbar">
    <div class="tb-room" id="tb-room">Room 1</div>
    <div class="tb-group">
      <div class="tb-pill"><span class="ic">â±ï¸</span><span id="timer">20:00</span></div>
      <div class="tb-pill"><span class="ic">ğŸ’¡</span><span id="tb-hints">3</span></div>
      <div class="tb-pill"><span class="ic">ğŸƒ</span><span id="tb-clues">0</span></div>
      <button class="tb-btn" id="btn-hint">Hint</button>
      <button class="tb-btn" id="btn-inv">Clues</button>
    </div>
  </div>
  <div id="room-wrap"><div id="room-bg"></div></div>
  <div id="narration">
    <div class="nar-av">ğŸ•µï¸</div>
    <div id="nar-text">Welcome, detective.</div>
  </div>
</div>

<!-- â•â•â• VICTORY â•â•â• -->
<div id="victory" class="screen">
  <div class="sparkles" id="sparkles"></div>
  <div class="v-icon">ğŸ‰</div>
  <h1 class="v-title">Case Solved!</h1>
  <div class="v-sub">You found the Johnson family! They are safe and together again.<br>Great work, Detective!</div>
  <div class="v-family" id="v-family"></div>
  <div class="v-time" id="v-time">â±ï¸ Time: 00:00</div><br>
  <button class="btn-again" id="btn-again">Play Again</button>
</div>

<!-- â•â•â• GAME OVER â•â•â• -->
<div id="gameover" class="screen">
  <div class="go-icon">â°</div>
  <h1 class="go-title">Time's Up!</h1>
  <div class="go-sub">The Johnson family is still missingâ€¦ Try again, Detective!</div>
  <button class="btn-retry" id="btn-retry">Try Again</button>
</div>

<!-- â•â•â• CLUE MODAL â•â•â• -->
<div class="overlay" id="ov-clue">
  <div class="modal">
    <button class="m-close" id="clue-close">âœ•</button>
    <div class="m-header" id="clue-header">
      <img id="clue-img" src="" alt="Clue" onerror="this.style.display='none'">
      <span class="m-emoji" id="clue-emoji"></span>
    </div>
    <div class="m-body">
      <div class="m-title" id="clue-title"></div>
      <div class="m-text" id="clue-text"></div>
      <div class="q-box" id="clue-qbox">
        <label id="clue-qlabel"></label>
        <div class="q-row">
          <input type="text" id="clue-input" placeholder="Type your answer..." autocomplete="off">
          <button class="btn-check" id="clue-submit">Check</button>
        </div>
        <div class="feedback" id="clue-fb"></div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• CODE MODAL â•â•â• -->
<div class="overlay" id="ov-code">
  <div class="modal">
    <button class="m-close" id="code-close">âœ•</button>
    <div class="code-wrap">
      <h3>ğŸ”’ Unlock the Door</h3>
      <p id="code-status">Find clues to reveal the code!</p>
      <div style="font-size:.72rem;color:var(--dim);margin-bottom:4px">REVEALED CODE:</div>
      <div class="revealed-code" id="rev-boxes"></div>
      <div style="font-size:.72rem;color:var(--dim);margin-bottom:4px">YOUR INPUT:</div>
      <div class="input-code" id="in-boxes"></div>
      <div class="keypad" id="keypad"></div>
      <div class="code-fb" id="code-fb"></div>
    </div>
  </div>
</div>

<!-- â•â•â• ROOM 3 MODAL â•â•â• -->
<div class="overlay" id="ov-r3">
  <div class="modal" style="max-width:540px">
    <button class="m-close" id="r3-close">âœ•</button>
    <div class="fill-wrap">
      <h3>ğŸ” The Final Challenge</h3>
      <div class="sub">Complete the sentences using the verb TO BE:<br><b>am, is, are</b></div>
      <div id="fill-sents"></div>
      <div class="feedback" id="fill-fb" style="text-align:center;margin-top:8px"></div>
      <button class="btn-final" id="btn-fill-check">âœ“ Check Answers</button>
    </div>
  </div>
</div>

<!-- â•â•â• INVENTORY â•â•â• -->
<div class="inv-bg" id="inv-bg"></div>
<div class="inv-panel" id="inv-panel">
  <div class="inv-top">
    <span>ğŸƒ Clue Cards</span>
    <button class="inv-x" id="inv-close">âœ•</button>
  </div>
  <div id="inv-cards"></div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CHARS = [
  {name:'Tom Johnson', role:'Father, 45', emoji:'ğŸ‘¨â€ğŸ’¼', color:'#2563eb'},
  {name:'Mary Johnson', role:'Mother, 42', emoji:'ğŸ‘©â€ğŸ¦°', color:'#dc2626'},
  {name:'Leo Johnson', role:'Son, 16', emoji:'ğŸ‘¦', color:'#16a34a'},
  {name:'Emma Johnson', role:'Daughter, 12', emoji:'ğŸ‘§', color:'#ec4899'}
];

const ROOMS = {
  1:{
    name:'Room 1 â€” The Living Room ğŸ›‹ï¸',
    bg:'https://images.unsplash.com/photo-1616486338812-3dadae4b4ace?w=900&h=500&fit=crop',
    grad:'linear-gradient(135deg,#3d2b1f,#5c3d2e,#2d1f15)',
    intro:'You enter the Johnson family\'s living room. It feels <b>warm</b> but empty. Look around â€” there are <b>clues</b> everywhere! Click on the glowing objects to investigate.',
    code:'4215',
    hints:[
      'ğŸ’¡ Look at the family photo carefully. What color does Tom always wear?',
      'ğŸ’¡ The letter mentions a birthday. How old is Mary now?',
      'ğŸ’¡ Check the calendar. What city is Tom\'s flight from?'
    ],
    objects:[
      {
        emoji:'ğŸ“¸',label:'Photo',top:'22%',left:'12%',
        img:'https://images.unsplash.com/photo-1609220136736-443140cffec6?w=500&h=280&fit=crop',
        headerColor:'#1a3a5c',
        title:'ğŸ“¸ Family Photo',
        text:'You find a family photo on the wall. Tom Johnson is smiling. He is wearing a <em>blue</em> shirt â€” he always wears blue. It is his <em>favorite color</em>!',
        question:'What is Tom\'s favorite color?',
        answer:'blue',
        clue:'Tom\'s favorite color is blue.',
        hint:'Look at Tom\'s shirt. What color is it?'
      },
      {
        emoji:'âœ‰ï¸',label:'Letter',top:'55%',left:'28%',
        img:'https://images.unsplash.com/photo-1555685812-4b943f1cb0eb?w=500&h=280&fit=crop',
        headerColor:'#3d2b1f',
        title:'âœ‰ï¸ A Birthday Letter',
        text:'"Dear Mary,<br>Happy <em>42nd</em> Birthday!<br>With all my love, Tom.<br>P.S. I remember when we first met in Paris."',
        question:'How old is Mary?',
        answer:'42',
        clue:'Mary is 42 years old.',
        hint:'Read the letter again. It says "Happy ___th Birthday".'
      },
      {
        emoji:'ğŸ“…',label:'Calendar',top:'20%',left:'58%',
        img:'https://images.unsplash.com/photo-1506784365847-bbad939e9335?w=500&h=280&fit=crop',
        headerColor:'#2a1a3a',
        title:'ğŸ“… Wall Calendar',
        text:'The calendar has a note: "<em>Tom\'s flight: London â†’ Home</em>." Tom misses his hometown. Tom is from <em>London</em>!',
        question:'Where is Tom from?',
        answer:'london',
        clue:'Tom is from London.',
        hint:'What city does the flight depart from?'
      },
      {
        emoji:'ğŸ•',label:'Dog Collar',top:'68%',left:'65%',
        img:'https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=500&h=280&fit=crop',
        headerColor:'#2d3a1f',
        title:'ğŸ• Dog Collar',
        text:'You find a dog collar on the sofa. The tag says: "<em>Max</em> â€” Tom\'s best friend." Tom\'s favorite animal is a <em>dog</em>!',
        question:'What is Tom\'s favorite animal?',
        answer:'dog',
        clue:'Tom\'s favorite animal is a dog.',
        hint:'Read the collar tag. What kind of animal is Max?'
      }
    ]
  },
  2:{
    name:'Room 2 â€” The Bedrooms ğŸ›ï¸',
    bg:'https://images.unsplash.com/photo-1540518614846-7eded433c457?w=900&h=500&fit=crop',
    grad:'linear-gradient(135deg,#1a1a2e,#16213e,#1a1a2e)',
    intro:'You enter the bedrooms. Each family member has personal things here. Search for <b>diaries, photos, and notebooks</b> to learn more!',
    code:'7382',
    hints:[
      'ğŸ’¡ Leo writes about his pet in his diary. What kind of animal is it?',
      'ğŸ’¡ Look at Emma\'s photo frame. How old is she now?',
      'ğŸ’¡ Mary paints with one color. What color does she love?'
    ],
    objects:[
      {
        emoji:'ğŸ“”',label:'Diary',top:'35%',left:'10%',
        img:'https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=500&h=280&fit=crop',
        headerColor:'#2a2a1a',
        title:'ğŸ“” Leo\'s Diary',
        text:'"Today I fed my <em>turtle</em>, Shelly. Turtles are the best animals! I am 16 years old, and Shelly is my best friend." â€” Leo',
        question:'What is Leo\'s favorite animal?',
        answer:'turtle',
        clue:'Leo\'s favorite animal is a turtle.',
        hint:'Leo writes about feeding his pet. What kind of pet is Shelly?'
      },
      {
        emoji:'ğŸ–¼ï¸',label:'Photo',top:'22%',left:'42%',
        img:'https://images.unsplash.com/photo-1553284965-83fd3e82fa5a?w=500&h=280&fit=crop',
        headerColor:'#1a2a20',
        title:'ğŸ–¼ï¸ Emma\'s Photo',
        text:'A photo shows a young girl riding a horse. The frame says: "<em>Emma â™¥ Star</em> â€” Best friends since she was 10. Now she is <em>12</em>!"',
        question:'How old is Emma?',
        answer:'12',
        clue:'Emma is 12 years old. She loves horses.',
        hint:'Read the frame text. It says "Now she is ___!"'
      },
      {
        emoji:'ğŸ¨',label:'Notebook',top:'58%',left:'52%',
        img:'https://images.unsplash.com/photo-1513364776144-60967b0f800f?w=500&h=280&fit=crop',
        headerColor:'#3a1a1a',
        title:'ğŸ¨ Mary\'s Art Notebook',
        text:'You find Mary\'s art notebook. Every page is painted in <em>RED</em>. A note says: "<em>Red</em> is the color of love. It is my <em>favorite color</em>!" â€” Mary',
        question:'What is Mary\'s favorite color?',
        answer:'red',
        clue:'Mary\'s favorite color is red.',
        hint:'What color does Mary use most in her paintings?'
      },
      {
        emoji:'âœï¸',label:'Drawing',top:'65%',left:'22%',
        img:'https://images.unsplash.com/photo-1596464716127-f2a82984de30?w=500&h=280&fit=crop',
        headerColor:'#2a1a3a',
        title:'âœï¸ A Family Drawing',
        text:'A child\'s drawing shows four people: "Dad Tom, Mom Mary, brother Leo, and me â€” <em>Emma</em>!" Emma is Tom\'s <em>daughter</em>.',
        question:'Who is Tom\'s daughter?',
        answer:'emma',
        clue:'Emma is Tom\'s daughter. Leo is Tom\'s son.',
        hint:'Look at who drew this picture. She writes "me â€” ___!"'
      }
    ]
  },
  3:{
    name:'Room 3 â€” The Secret Room ğŸ”',
    bg:'https://images.unsplash.com/photo-1558618666-fcd25c85f82e?w=900&h=500&fit=crop',
    grad:'linear-gradient(135deg,#0d0d1a,#1a0d1a,#0d0d0d)',
    intro:'You found a <b>secret room</b>! The last lock needs the correct <b>grammar</b> to open. Complete the sentences using <b>am, is,</b> or <b>are</b>. This is your <b>final challenge</b>!',
    hints:[
      'ğŸ’¡ Use IS for one person or thing: Tom IS 45.',
      'ğŸ’¡ Use ARE for two or more: They ARE the parents.',
      'ğŸ’¡ "I AM" â€” "He/She/It IS" â€” "We/They ARE"'
    ],
    sentences:[
      {before:'Tom',after:'45 years old.',answer:'is'},
      {before:'Mary and Tom',after:'the parents.',answer:'are'},
      {before:"Emma's favorite animal",after:'a horse.',answer:'is'},
      {before:'Leo',after:'16 years old.',answer:'is'},
      {before:'The children',after:'Leo and Emma.',answer:'are'}
    ]
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let S = {
  room: 0,
  time: 1200,
  tick: null,
  hints: {1:3, 2:3, 3:3},
  clues: [],
  done: {1:[false,false,false,false], 2:[false,false,false,false]},
  cur: null,
  codeIn: '',
  t0: 0
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function $(id){return document.getElementById(id)}
function show(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));$(id).classList.add('active')}
function narrate(html){$('nar-text').innerHTML=html}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT INTRO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function initIntro(){
  var h='';
  CHARS.forEach(function(c){
    h+='<div class="char-card"><div class="char-avatar" style="background:'+c.color+'22;border-color:'+c.color+'">'+c.emoji+'</div><div class="c-name">'+c.name+'</div><div class="c-role">'+c.role+'</div></div>';
  });
  $('intro-chars').innerHTML=h;
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// START GAME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
$('btn-start').addEventListener('click',function(){
  S.t0=Date.now();
  S.room=1;
  show('game');
  enterRoom(1);
  startTimer();
});

$('btn-again').addEventListener('click',function(){location.reload()});
$('btn-retry').addEventListener('click',function(){location.reload()});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TIMER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startTimer(){
  S.tick=setInterval(function(){
    S.time--;
    if(S.time<=0){clearInterval(S.tick);show('gameover');return}
    var m=Math.floor(S.time/60),s=S.time%60;
    var el=$('timer');
    el.textContent=(m<10?'0':'')+m+':'+(s<10?'0':'')+s;
    if(S.time<=120)el.classList.add('warn');else el.classList.remove('warn');
  },1000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENTER ROOM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function enterRoom(num){
  S.room=num;
  var r=ROOMS[num];

  $('tb-room').textContent=r.name;
  $('tb-hints').textContent=S.hints[num];
  $('tb-clues').textContent=S.clues.length;

  var bg=$('room-bg');
  bg.innerHTML='';
  bg.style.background=r.grad;
  // Try loading image
  var testImg=new Image();
  testImg.onload=function(){bg.style.backgroundImage="url('"+r.bg+"')";bg.style.backgroundSize='cover';bg.style.backgroundPosition='center'};
  testImg.src=r.bg;

  if(num<=2){
    r.objects.forEach(function(obj,i){
      var done=S.done[num][i];
      var el=document.createElement('div');
      el.className='obj-btn'+(done?' solved':'');
      el.style.top=obj.top;
      el.style.left=obj.left;
      el.innerHTML='<span class="emo">'+obj.emoji+'</span><span class="lbl">'+obj.label+'</span>';
      if(!done){
        (function(rn,idx){
          el.addEventListener('click',function(){openClue(rn,idx)});
        })(num,i);
      }
      bg.appendChild(el);
    });

    // Door
    var allDone=S.done[num].every(function(v){return v});
    var door=document.createElement('div');
    door.className='door'+(allDone?' open':'');
    door.innerHTML='<span class="d-icon">'+(allDone?'ğŸ”“':'ğŸ”’')+'</span><span class="d-label">'+(allDone?'OPEN':'LOCKED')+'</span><div class="dots">'+r.code.split('').map(function(_,i){return '<span class="dot'+(S.done[num][i]?' on':'')+'"></span>'}).join('')+'</div>';
    (function(rn){
      door.addEventListener('click',function(){openCode(rn)});
    })(num);
    bg.appendChild(door);
  } else {
    // Room 3
    var center=document.createElement('div');
    center.className='r3-center';
    center.innerHTML='<div class="r3-card"><h3>ğŸ” The Secret Room</h3><p>This is the final challenge! Complete sentences about the Johnson family using the verb <b>TO BE</b>.</p><button class="btn-final" id="btn-open-r3">Open Final Challenge</button></div>';
    bg.appendChild(center);
    setTimeout(function(){
      var b=$('btn-open-r3');
      if(b)b.addEventListener('click',openR3);
    },50);
  }

  narrate(r.intro);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLUE MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openClue(room,idx){
  S.cur={room:room,idx:idx};
  var obj=ROOMS[room].objects[idx];

  var header=$('clue-header');
  header.style.background=obj.headerColor;
  var img=$('clue-img');
  img.style.display='block';
  img.src=obj.img;
  img.onerror=function(){this.style.display='none'};
  $('clue-emoji').textContent=obj.emoji;

  $('clue-title').textContent=obj.title;
  $('clue-text').innerHTML=obj.text;
  $('clue-qlabel').textContent='â“ '+obj.question;

  var inp=$('clue-input');
  inp.value='';
  inp.className='';
  inp.disabled=false;

  var fb=$('clue-fb');
  fb.className='feedback';
  fb.textContent='';

  if(S.done[room][idx]){
    inp.value=obj.answer;
    inp.classList.add('ok');
    inp.disabled=true;
    fb.className='feedback show yes';
    fb.textContent='âœ“ Correct! Clue card collected.';
  }

  $('ov-clue').classList.add('show');
  if(!S.done[room][idx])setTimeout(function(){inp.focus()},200);
}

function closeClue(){
  $('ov-clue').classList.remove('show');
  S.cur=null;
}

function submitClue(){
  if(!S.cur)return;
  var room=S.cur.room, idx=S.cur.idx;
  if(S.done[room][idx])return;
  var obj=ROOMS[room].objects[idx];
  var inp=$('clue-input');
  var val=inp.value.trim().toLowerCase();
  var fb=$('clue-fb');

  if(val===obj.answer.toLowerCase()){
    S.done[room][idx]=true;
    inp.classList.add('ok');
    inp.disabled=true;
    fb.className='feedback show yes';

    // Show which digit was found
    var digitVal=ROOMS[room].code[idx];
    fb.textContent='âœ… Correct! Code digit #'+(idx+1)+' is: '+digitVal;

    S.clues.push(obj.clue);
    $('tb-clues').textContent=S.clues.length;

    setTimeout(function(){
      closeClue();
      enterRoom(room);
      var left=S.done[room].filter(function(v){return !v}).length;
      if(left===0){
        narrate('All clues found! Click the <b>door lock</b> ğŸ”’ to enter the code and unlock the next room!');
      } else {
        narrate('Great work! <b>'+left+'</b> more clue'+(left>1?'s':'')+' to find. Keep searching! ğŸ”');
      }
    },1400);
  } else {
    inp.classList.remove('no');
    void inp.offsetWidth;
    inp.classList.add('no');
    fb.className='feedback show nope';
    fb.textContent='âŒ Not quite! '+obj.hint;
    setTimeout(function(){inp.classList.remove('no')},500);
  }
}

$('clue-close').addEventListener('click',closeClue);
$('clue-submit').addEventListener('click',submitClue);
$('clue-input').addEventListener('keydown',function(e){if(e.key==='Enter')submitClue()});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CODE MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openCode(room){
  var r=ROOMS[room];
  var allDone=S.done[room].every(function(v){return v});
  var found=S.done[room].filter(function(v){return v}).length;

  $('code-status').textContent=allDone?'All digits found! Enter the code below.':'Digits found: '+found+'/'+r.code.length+'. Find more clues!';

  // Revealed boxes
  var revH='';
  r.code.split('').forEach(function(d,i){
    revH+='<div class="rev-box'+(S.done[room][i]?' found':'')+'">'+( S.done[room][i]?d:'?')+'</div>';
  });
  $('rev-boxes').innerHTML=revH;

  // Input boxes
  var inH='';
  for(var i=0;i<r.code.length;i++){
    inH+='<div class="in-box" id="ib-'+i+'"></div>';
  }
  $('in-boxes').innerHTML=inH;

  // Keypad
  var kpH='';
  for(var n=1;n<=9;n++) kpH+='<button class="kp" data-k="'+n+'">'+n+'</button>';
  kpH+='<button class="kp kp-del" data-k="del">âŒ«</button>';
  kpH+='<button class="kp" data-k="0">0</button>';
  kpH+='<button class="kp kp-go" data-k="go">âœ“</button>';
  $('keypad').innerHTML=kpH;

  // Attach keypad events
  document.querySelectorAll('#keypad .kp').forEach(function(btn){
    btn.addEventListener('click',function(){
      var k=this.getAttribute('data-k');
      if(k==='del') codeBack();
      else if(k==='go') codeGo(room);
      else codeType(k,room);
    });
  });

  S.codeIn='';
  $('code-fb').textContent='';
  $('code-fb').style.color='';
  $('ov-code').classList.add('show');
}

function closeCode(){$('ov-code').classList.remove('show')}

function codeType(d,room){
  var len=ROOMS[room].code.length;
  if(S.codeIn.length>=len)return;
  S.codeIn+=d;
  refreshCodeBoxes(room);
}

function codeBack(){
  S.codeIn=S.codeIn.slice(0,-1);
  refreshCodeBoxes(S.room);
}

function refreshCodeBoxes(room){
  var len=ROOMS[room].code.length;
  for(var i=0;i<len;i++){
    var box=$('ib-'+i);
    if(!box)continue;
    if(i<S.codeIn.length){
      box.textContent=S.codeIn[i];
      box.className='in-box filled';
    } else {
      box.textContent='';
      box.className='in-box';
    }
  }
}

function codeGo(room){
  var r=ROOMS[room];
  var allDone=S.done[room].every(function(v){return v});
  var fb=$('code-fb');

  if(!allDone){
    fb.textContent='âš ï¸ Find all clues first!';
    fb.style.color='var(--red)';
    return;
  }

  if(S.codeIn===r.code){
    // Correct!
    for(var i=0;i<r.code.length;i++){
      var box=$('ib-'+i);
      if(box)box.className='in-box right';
    }
    fb.textContent='ğŸ”“ Door unlocked!';
    fb.style.color='var(--green)';

    setTimeout(function(){
      closeCode();
      if(room+1<=3) enterRoom(room+1);
    },1300);
  } else {
    // Wrong
    for(var i=0;i<r.code.length;i++){
      var box=$('ib-'+i);
      if(box){box.classList.remove('wrong');void box.offsetWidth;box.classList.add('wrong')}
    }
    fb.textContent='âŒ Wrong code! Look at the revealed digits above.';
    fb.style.color='var(--red)';
    setTimeout(function(){
      S.codeIn='';
      refreshCodeBoxes(room);
      for(var i=0;i<r.code.length;i++){var box=$('ib-'+i);if(box)box.classList.remove('wrong')}
    },900);
  }
}

$('code-close').addEventListener('click',closeCode);

// Keyboard for code
document.addEventListener('keydown',function(e){
  if(!$('ov-code').classList.contains('show'))return;
  if(e.key>='0'&&e.key<='9') codeType(e.key,S.room);
  else if(e.key==='Backspace') codeBack();
  else if(e.key==='Enter') codeGo(S.room);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ROOM 3 â€” FILL IN BLANKS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openR3(){
  var sents=ROOMS[3].sentences;
  var h='';
  sents.forEach(function(s,i){
    h+='<div class="sent" id="s-'+i+'"><span>'+s.before+' </span><input type="text" class="fill-in" id="fi-'+i+'" placeholder="___" autocomplete="off"><span> '+s.after+'</span></div>';
  });
  $('fill-sents').innerHTML=h;
  var fb=$('fill-fb');
  fb.className='feedback';fb.textContent='';
  $('ov-r3').classList.add('show');
  setTimeout(function(){var f=$('fi-0');if(f)f.focus()},200);
}

function closeR3(){$('ov-r3').classList.remove('show')}

function checkR3(){
  var sents=ROOMS[3].sentences;
  var allOk=true;
  sents.forEach(function(s,i){
    var inp=$('fi-'+i);
    var row=$('s-'+i);
    var val=inp.value.trim().toLowerCase();
    inp.classList.remove('f-ok','f-no');
    row.classList.remove('s-ok','s-no');
    if(val===s.answer){
      inp.classList.add('f-ok');
      row.classList.add('s-ok');
    } else {
      inp.classList.add('f-no');
      row.classList.add('s-no');
      allOk=false;
    }
  });
  var fb=$('fill-fb');
  if(allOk){
    fb.className='feedback show yes';
    fb.innerHTML='ğŸ‰ All correct! You solved the mystery!';
    setTimeout(function(){closeR3();victory()},1800);
  } else {
    fb.className='feedback show nope';
    fb.innerHTML='âŒ Some answers are wrong. Remember: <b>IS</b> for one, <b>ARE</b> for two or more!';
    setTimeout(function(){
      sents.forEach(function(s,i){
        var inp=$('fi-'+i);var row=$('s-'+i);
        if(inp.classList.contains('f-no')){inp.classList.remove('f-no');row.classList.remove('s-no')}
      });
    },1200);
  }
}

$('r3-close').addEventListener('click',closeR3);
$('btn-fill-check').addEventListener('click',checkR3);
document.addEventListener('keydown',function(e){
  if($('ov-r3').classList.contains('show')&&e.key==='Enter')checkR3();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HINTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
$('btn-hint').addEventListener('click',function(){
  var r=S.room;
  if(!S.hints[r]||S.hints[r]<=0){narrate("No more hints for this room! You can do it! ğŸ’ª");return}
  var idx=ROOMS[r].hints.length-S.hints[r];
  S.hints[r]--;
  $('tb-hints').textContent=S.hints[r];
  narrate(ROOMS[r].hints[idx]);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INVENTORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleInv(){
  var open=$('inv-panel').classList.contains('show');
  if(open){
    $('inv-panel').classList.remove('show');
    $('inv-bg').classList.remove('show');
  } else {
    var h='';
    if(S.clues.length===0){
      h='<div class="inv-empty">No clue cards yet.<br>Examine objects to collect clues!</div>';
    } else {
      S.clues.forEach(function(c,i){
        h+='<div class="inv-card"><b>Clue #'+(i+1)+':</b> '+c+'</div>';
      });
    }
    $('inv-cards').innerHTML=h;
    $('inv-panel').classList.add('show');
    $('inv-bg').classList.add('show');
  }
}
$('btn-inv').addEventListener('click',toggleInv);
$('inv-close').addEventListener('click',toggleInv);
$('inv-bg').addEventListener('click',toggleInv);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VICTORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function victory(){
  clearInterval(S.tick);
  show('victory');
  var elapsed=Math.floor((Date.now()-S.t0)/1000);
  var m=Math.floor(elapsed/60),s=elapsed%60;
  $('v-time').textContent='â±ï¸ Time: '+(m<10?'0':'')+m+':'+(s<10?'0':'')+s;

  var h='';
  CHARS.forEach(function(c){
    h+='<div class="v-member"><div class="vm-av" style="background:'+c.color+'22;border-color:'+c.color+'">'+c.emoji+'</div><div class="vm-n">'+c.name+'</div></div>';
  });
  $('v-family').innerHTML=h;

  // Sparkles
  var sp=$('sparkles');sp.innerHTML='';
  var colors=['#f5c518','#3fb950','#58a6ff','#e94560','#fff','#a855f7'];
  for(var i=0;i<50;i++){
    var d=document.createElement('div');
    d.className='sp';
    d.style.left=Math.random()*100+'%';
    d.style.width=d.style.height=(3+Math.random()*5)+'px';
    d.style.background=colors[Math.floor(Math.random()*colors.length)];
    d.style.animationDuration=(2+Math.random()*4)+'s';
    d.style.animationDelay=Math.random()*3+'s';
    sp.appendChild(d);
  }
}
</script>
</body>
</html>
